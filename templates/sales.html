{% extends "base.html" %}
{% block content %}

<h1 class="mb-4">Daily Sales</h1>

<!-- Date Filter -->
<div class="card">
    <div class="card-body">
        <form method="GET" action="{{ url_for('sales') }}" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Select Date</label>
                <input type="date" name="date" class="form-control" value="{{ selected_date.strftime('%Y-%m-%d') }}" required>
            </div>
            <div class="col-md-8 d-flex align-items-end gap-2">
                <button type="submit" class="btn btn-primary">View Sales</button>
                <a href="{{ url_for('add_sale') }}" class="btn btn-success">Add Sale</a>
            </div>
        </form>
    </div>
</div>

<!-- Summary Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-card-icon">üí∞</div>
        <div class="stat-card-label">Total Sales</div>
        <div class="stat-card-value">Rs {{ "%.2f"|format(total_sales) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon">‚úÖ</div>
        <div class="stat-card-label">Total Paid</div>
        <div class="stat-card-value">Rs {{ "%.2f"|format(total_paid) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon">‚ö†Ô∏è</div>
        <div class="stat-card-label">Total Unpaid</div>
        <div class="stat-card-value balance-unpaid">Rs {{ "%.2f"|format(total_unpaid) }}</div>
    </div>
</div>

<!-- Sales List -->
<div class="card">
    <div class="card-body">
        <h2 class="mb-4">Sales for {{ selected_date.strftime('%B %d, %Y') }}</h2>
        
        <!-- Desktop Table -->
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total</th>
                        <th>Paid</th>
                        <th>Unpaid</th>
                        <th>Customer</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in sales %}
                    <tr>
                        <td><strong>{{ s.item.name }}</strong></td>
                        <td>{{ s.quantity }} {{ s.item.unit }}</td>
                        <td>Rs {{ "%.2f"|format(s.unit_price) }}</td>
                        <td><strong>Rs {{ "%.2f"|format(s.total_price) }}</strong></td>
                        <td>Rs {{ "%.2f"|format(s.paid_amount) }}</td>
                        <td>
                            {% set unpaid = s.total_price - s.paid_amount %}
                            {% if unpaid > 0 %}
                                <span class="balance-unpaid">Rs {{ "%.2f"|format(unpaid) }}</span>
                            {% else %}
                                <span class="balance-paid">Rs 0.00</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if s.customer %}
                                <a href="{{ url_for('customer_detail', id=s.customer.id) }}" style="text-decoration: none; color: var(--color-primary);">
                                    {{ s.customer.name }}
                                </a>
                            {% else %}
                                <span class="text-muted">Cash</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if s.customer %}
                                <a href="{{ url_for('invoice', sale_id=s.id) }}" class="btn btn-sm btn-primary">Invoice</a>
                            {% endif %}
                            <a href="{{ url_for('delete_sale', id=s.id) }}"
                               class="btn btn-sm btn-danger"
                               onclick="return confirm('Delete this sale?')">
                               Delete
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">No sales found for this date.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Mobile Cards -->
        <div class="table-mobile-card">
            {% for s in sales %}
            <div class="mobile-card">
                <div class="mobile-card-header">{{ s.item.name }}</div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Quantity</span>
                    <span class="mobile-card-value">{{ s.quantity }} {{ s.item.unit }}</span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Unit Price</span>
                    <span class="mobile-card-value">Rs {{ "%.2f"|format(s.unit_price) }}</span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Total</span>
                    <span class="mobile-card-value"><strong>Rs {{ "%.2f"|format(s.total_price) }}</strong></span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Paid</span>
                    <span class="mobile-card-value">Rs {{ "%.2f"|format(s.paid_amount) }}</span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Unpaid</span>
                    <span class="mobile-card-value">
                        {% set unpaid = s.total_price - s.paid_amount %}
                        {% if unpaid > 0 %}
                            <span class="balance-unpaid">Rs {{ "%.2f"|format(unpaid) }}</span>
                        {% else %}
                            <span class="balance-paid">Rs 0.00</span>
                        {% endif %}
                    </span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Customer</span>
                    <span class="mobile-card-value">
                        {% if s.customer %}
                            <a href="{{ url_for('customer_detail', id=s.customer.id) }}" style="text-decoration: none; color: var(--color-primary);">
                                {{ s.customer.name }}
                            </a>
                        {% else %}
                            <span class="text-muted">Cash</span>
                        {% endif %}
                    </span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Actions</span>
                    <span class="mobile-card-value">
                        {% if s.customer %}
                            <a href="{{ url_for('invoice', sale_id=s.id) }}" class="btn btn-sm btn-primary">Invoice</a>
                        {% endif %}
                        <a href="{{ url_for('delete_sale', id=s.id) }}"
                           class="btn btn-sm btn-danger"
                           onclick="return confirm('Delete this sale?')">
                           Delete
                        </a>
                    </span>
                </div>
            </div>
            {% else %}
            <div class="mobile-card text-center text-muted">
                No sales found for this date.
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}
