{% extends "base.html" %}
{% block content %}

<h1 class="mb-4">Customer Ledger: {{ customer.name }}</h1>

<!-- Customer Info Card -->
<div class="card">
    <div class="card-body">
        <h2>{{ customer.name }}</h2>
        <p class="mb-0"><strong>Phone:</strong> <a href="tel:{{ customer.phone }}" style="text-decoration: none; color: var(--color-primary);">{{ customer.phone }}</a></p>
    </div>
</div>

<!-- Summary Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-card-icon">üí∞</div>
        <div class="stat-card-label">Total Bill</div>
        <div class="stat-card-value">Rs {{ "%.2f"|format(total_bill) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon">‚úÖ</div>
        <div class="stat-card-label">Total Paid</div>
        <div class="stat-card-value">Rs {{ "%.2f"|format(total_paid) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon">‚ö†Ô∏è</div>
        <div class="stat-card-label">Outstanding Balance</div>
        <div class="stat-card-value balance-unpaid">Rs {{ "%.2f"|format(balance) }}</div>
    </div>
</div>

<!-- Sales History -->
<div class="card">
    <div class="card-body">
        <h2 class="mb-4">Credit Sales History</h2>
        
        <!-- Desktop Table -->
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Total Amount</th>
                        <th>Paid Amount</th>
                        <th>Remaining Balance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in sales %}
                    <tr>
                        <td>{{ s.date.strftime('%Y-%m-%d') }}</td>
                        <td><strong>{{ s.item.name }}</strong></td>
                        <td>{{ s.quantity }} {{ s.item.unit }}</td>
                        <td><strong>Rs {{ "%.2f"|format(s.total_price) }}</strong></td>
                        <td>Rs {{ "%.2f"|format(s.paid_amount) }}</td>
                        <td>
                            {% set unpaid = s.total_price - s.paid_amount %}
                            {% if unpaid > 0 %}
                                <span class="balance-unpaid">Rs {{ "%.2f"|format(unpaid) }}</span>
                            {% else %}
                                <span class="balance-paid">Rs 0.00</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('invoice', sale_id=s.id) }}" class="btn btn-sm btn-primary">Invoice</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">No credit sales found for this customer.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Mobile Cards -->
        <div class="table-mobile-card">
            {% for s in sales %}
            <div class="mobile-card">
                <div class="mobile-card-header">{{ s.item.name }}</div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Date</span>
                    <span class="mobile-card-value">{{ s.date.strftime('%Y-%m-%d') }}</span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Quantity</span>
                    <span class="mobile-card-value">{{ s.quantity }} {{ s.item.unit }}</span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Total Amount</span>
                    <span class="mobile-card-value"><strong>Rs {{ "%.2f"|format(s.total_price) }}</strong></span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Paid Amount</span>
                    <span class="mobile-card-value">Rs {{ "%.2f"|format(s.paid_amount) }}</span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Remaining Balance</span>
                    <span class="mobile-card-value">
                        {% set unpaid = s.total_price - s.paid_amount %}
                        {% if unpaid > 0 %}
                            <span class="balance-unpaid">Rs {{ "%.2f"|format(unpaid) }}</span>
                        {% else %}
                            <span class="balance-paid">Rs 0.00</span>
                        {% endif %}
                    </span>
                </div>
                <div class="mobile-card-row">
                    <span class="mobile-card-label">Actions</span>
                    <span class="mobile-card-value">
                        <a href="{{ url_for('invoice', sale_id=s.id) }}" class="btn btn-sm btn-primary">Invoice</a>
                    </span>
                </div>
            </div>
            {% else %}
            <div class="mobile-card text-center text-muted">
                No credit sales found for this customer.
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="text-center">
    <a href="{{ url_for('customers') }}" class="btn btn-secondary">Back to Customers</a>
</div>

{% endblock %}
